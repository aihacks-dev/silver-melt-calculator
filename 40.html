<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>40% Silver Melt Calculator</title>
  <style>
    body { font-family: -apple-system, system-ui, Arial; margin: 18px; line-height: 1.35; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; margin: 12px 0; }
    input, select { font-size: 18px; padding: 10px; width: 100%; box-sizing: border-box; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .big { font-size: 22px; font-weight: 700; }
    .muted { color: #666; }
    .mono { font-variant-numeric: tabular-nums; }
    .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; background:#f3f3f3; }
    h3 { margin: 0 0 10px; }
  </style>
</head>

<body>
  <h2>40% Silver Melt Calculator</h2>

  <div class="card">
    <label class="muted">Silver spot price ($/troy oz)</label>
    <input id="spot" inputmode="decimal" placeholder="e.g. 75.00" value="75.00" />
    <p class="muted" style="margin:10px 0 0;">Uses circulated/dealer standard: 0.2958 ozt per $1 face (40% US).</p>
  </div>

  <div class="card">
    <div class="row">
      <div>
        <div class="muted">Half (0.50 FV)</div>
        <div class="big mono" id="half">$0.00</div>
        <div class="muted mono">0.2958 ozt</div>
      </div>
      <div>
        <div class="muted">Ike Dollar (1.00 FV)</div>
        <div class="big mono" id="one">$0.00</div>
        <div class="muted"><span class="pill mono" id="xface">0.0× face</span></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="muted" style="margin-bottom:8px;">Shop offer mode (optional)</div>
    <select id="mode">
      <option value="none">Off</option>
      <option value="xface">Shop quotes × face</option>
      <option value="pct">Shop pays % of melt</option>
      <option value="minus">Shop pays spot − $/oz</option>
    </select>

    <div style="margin-top:10px;">
      <input id="offer" inputmode="decimal" placeholder="Enter value (e.g., 48, 95, 3)" disabled />
      <div class="muted" style="margin-top:8px;" id="offerHelp"></div>
    </div>

    <div style="margin-top:12px;" class="muted">
      <div><strong>Implied shop payout</strong></div>
      <div class="mono" id="offerLine">—</div>
    </div>
  </div>

  <div class="card">
    <h3>Profit per Coin</h3>

    <label class="muted">Your buy price per coin ($)</label>
    <input id="buyPrice" inputmode="decimal" placeholder="e.g. 10.00" />

    <label class="muted" style="margin-top:10px;">Coin type</label>
    <select id="coinType">
      <option value="half">JFK Half Dollar (40%)</option>
      <option value="dollar">IKE Dollar (40%)</option>
    </select>

    <div class="row" style="margin-top:14px;">
      <div>
        <div class="muted">Melt value</div>
        <div class="big mono" id="meltPerCoin">$0.00</div>
      </div>
      <div>
        <div class="muted">Profit / Loss</div>
        <div class="big mono" id="profitPerCoin">$0.00</div>
      </div>
      <div>
        <div class="muted">Margin</div>
        <div class="big mono" id="marginPct">0.0%</div>
      </div>
      <div>
        <div class="muted">Breakeven spot</div>
        <div class="big mono" id="breakevenSpot">$0.00</div>
      </div>
    </div>
  </div>

<script>
  // Constants (circulated/dealer standard)
  const OZ_PER_1FV = 0.2958;
  const OZ_HALF = OZ_PER_1FV * 0.50;      // 0.2958

  // Profit section uses explicit constants too (same values)
  const OZ_PER_HALF = OZ_HALF;

  const $ = (id) => document.getElementById(id);

  function money(x) {
    return x.toLocaleString(undefined, { style: "currency", currency: "USD" });
  }

  function num(x) {
    const v = Number(String(x).replace(/[^0-9.]/g,''));
    return Number.isFinite(v) ? v : 0;
  }

  function updateProfit() {
    const spot = num($("spot").value);
    const buy = num($("buyPrice").value);
    const coin = $("coinType").value;

    if (!spot || !buy) {
      $("meltPerCoin").textContent = "$0.00";
      $("profitPerCoin").textContent = "$0.00";
      $("marginPct").textContent = "0.0%";
      $("breakevenSpot").textContent = "$0.00";
      return;
    }

    let oz = OZ_PER_HALF;
    if (coin === "half") oz = OZ_PER_HALF;

    if (coin === "dollar") oz = 0.3161;

    const melt = spot * oz;
    const profit = melt - buy;
    const margin = (profit / buy) * 100;
    const breakeven = buy / oz;

    $("meltPerCoin").textContent = money(melt);
    $("profitPerCoin").textContent = money(profit);
    $("marginPct").textContent = `${margin.toFixed(1)}%`;
    $("breakevenSpot").textContent = `$${breakeven.toFixed(2)}`;
  }

  function update() {
    const spot = num($("spot").value);

    const ike = spot * 0.3161;
    const melt1 = spot * OZ_PER_1FV;
    const half = spot * OZ_HALF;

    $("one").textContent = money(melt1);
    $("one").textContent = `${ike}`;
    $("xface").textContent = `${melt1.toFixed(2)}× face`;
    $("xface").textContent = `${ike}`;
    $("half").textContent = money(half);

    // Offer mode
    const mode = $("mode").value;
    const offerVal = num($("offer").value);

    let payoutPer1 = null;

    if (mode === "xface") 
    {
      payoutPer1 = offerVal; // dollars per $1FV
      $("offerHelp").textContent = "Enter the shop’s × face payout (e.g., 48 means $48 per $1 FV).";
    }
    else if (mode === "pct") 
    {
      payoutPer1 = melt1 * (offerVal / 100);
      $("offerHelp").textContent = "Enter the shop’s payout as % of melt (e.g., 95 means 95% of melt).";
    } 
    else if (mode === "minus") 
    {
      payoutPer1 = Math.max(0, (spot - offerVal)) * OZ_PER_1FV;
      $("offerHelp").textContent = "Enter $/oz discount from spot (e.g., 3 means spot − $3/oz).";
    } else {
      $("offerHelp").textContent = "";
    }

    if (mode === "none") 
    {
      $("offerLine").textContent = "—";
      updateProfit();
      return;
    }

    const impliedXFace = payoutPer1;
    const impliedPct = melt1 > 0 ? (payoutPer1 / melt1) * 100 : 0;
    const impliedSpot = OZ_PER_1FV > 0 ? (payoutPer1 / OZ_PER_1FV) : 0;

    const payoutHalf = payoutPer1 * 0.50;

    $("offerLine").textContent =
      `${money(payoutPer1)} per $1 FV (${impliedXFace.toFixed(2)}× face) • `
      + `${impliedPct.toFixed(1)}% of melt • `
      + `implied $${impliedSpot.toFixed(2)}/oz • `
      + `half ${money(payoutHalf)}`;

    updateProfit();
  }

  function onModeChange() {
    const mode = $("mode").value;
    $("offer").disabled = (mode === "none");
    $("offer").value = "";
    update();
  }

  $("spot").addEventListener("input", update);
  $("mode").addEventListener("change", onModeChange);
  $("offer").addEventListener("input", update);

  $("buyPrice").addEventListener("input", updateProfit);
  $("coinType").addEventListener("change", updateProfit);

  update();
</script>

</body>
</html> 